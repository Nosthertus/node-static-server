#!/usr/bin/env node

/*
 * Main packages
 */
var http 	= require("http"),
	fs		= require("fs"),
	path    = require("path"),
	args    = require("./../lib/args.js"),
	mime    = require("mime");

/*
 * Package settings
 */
var CONST = module.CONST = {
	dir: path.resolve(args.d),
	port: args.p,
	entry: args.e
};

/*
 * Libraries
 */
var directory = require("./../lib/path.js");

var server = http.createServer(function(req, res){
	if(req.url == "/"){
		req.url = "/index.html"
	}

	if(CONST.entry){
		req.url = CONST.entry
	}

	var dir = directory.resolve(req.url);

	var readStream = fs.createReadStream(dir);

	readStream.on("open", function(){
		res.writeHead(200, {
			"Content-Type": mime.lookup(dir)
		});

		readStream.pipe(res);
	});

	readStream.on("error", function(err){
		console.log(err);
		res.statusCode = 404;
		res.end("404 File not found!");
	});
});

server.listen(CONST.port, function(){
	console.log("Server listening at port:", CONST.port);
});
